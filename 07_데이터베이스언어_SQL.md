## 데이터베이스 언어 SQL

SQL은 사용자가 처리를 원하는 데이터가 무엇인지만 제시하고 데이터를 어떻게 처리해야 하는지를 언급할 필요가 없어 비절차적 데이터 언어의 특징을 가진다

데이터 정의어(DDL) : 테이블 생성/변경/삭제
데이터 조작어(DML) : 테이블에 데이터 삽입/수정/삭제/검색
데이터 제어어(DCL) : 보안을 위해 데이터에 대한 접근 및 사용권한 부여/취소. 주로 데이터 관리자가 사용



## 데이터 정의 
### FOREIGN KEY
외래키에서 참조되는 테이블에서 튜플을 삭제하거나 변경때 처리 방법
1. ON DELETE NO ACTION : 튜플을 삭제하지 못하게 한다(default)
2. ON DELETE CASCADE : 관련 튜플을 함께 삭제한다.
3. ON DELETE SET NULL : 관련 튜플의 외래키 값을 NULL로 변경한다.
4. ON DELETE SET DEFAULT : 관련 튜플의 외래키 값을 미리 지정한 기본 값으로 변경한다.

참조되는 테이블에서 튜플을 수정할 때 처리하는 방법
1. ON UPDATE NO ACTION : 튜플을 변경하지 못하도록 한다(default)
2. ON UPDATE CASCADE : 관련 튜플에서 외래키 값을 함께 변경한다
3. ON UPDATE SET NULL : 관련 튜플의 외래키 값을 NULL로 변경한다.
4. ON UPDATE SET DEFAULT : 관련 튜플의 외래키 값을 미리 지정한 기본 값으로 변경한다.

### 데이터 무결성 제약 조건
CEHCK - CHECK키워드를 통해서 지정한 제약조건을 만족하는 테이블만 삽입/수정할 수 있다.


## 데이터 조작

### 집계함수
특정 속성 값을 통계적으로 계산한 결과를 검색하기 위해 집계함수를 이용할 수 있다. SUM, AVG 등

집계함수를 사용할 때는 다음 두 가지 사항에 주의
- 집계함수는 NULL인 속성 값을 제외하고 계산한다.
- 집계함수는 WHERE 절에는 사용할 수 없고 SELECT절이나 HAVING절에만 사용할 수 있다.


## 뷰(View)

뷰는 다른 테이블을 기반으로 만들어진 가상 테이블이다. 일반 테이블과 달리 데이터를 실제로 저장하고 있지 않다.


## 연습문제


#### 2. 고객 테이블을 생성한 후, 주소 속성이 누락되었다. 주소 속성을 추가하기에 적합한 SQL 명령어는?
- ALTER

#### 3. 학생 테이블을 참조하는 제약조건과 함께 학생 테이블을 제거하는 SQL문
- DROP TABLE 학생 CASCADE CONSTRAINTS

#### 10. SQL의 DELETE 명령문에 대한 설명으로 옳지 않은 것은?
(2) - WHERE절 없는 DELETE는 데이터를 모두 삭제하지만, 테이블은 남아있기 때문에 DRTOP TABLE과는 다르다

```
1. 테이블의 튜플을 삭제할 때 사용한다.
2. 특정 테이블에 대하여 WHERE 절이 없는 DELETE 명령문을 수행하면 DROP TABLE 명령문을 수행했을 때와 같은 효과를 얻을 수 있다.
3. SQL을 기능에 따라 분류할 경우 DML에 해당한다.
4. 기본 사용 형식은 "DELETE FROM 테이블 [WHERE 조건];"이다
```

#### 16. 다음은 외래키를 정의하는 SQL문의 형식 중 일부다. 옵션으로 선택할 수 없는 것은?
- CHECK
```
FOREIGN KEY (속성_리스트) REFERENCES 테이블_이름(속성_리스트)
[ON DELETE 옵션] [ON UPDATE 옵션]

1. NO ACTION
2. CEHCK
3. CASCADE
4. SET NULL
```

#### 17. 기본 테이블 R과 S를 조인해서 뷰 V1을 정의하고, 뷰V1을 이용해 뷰 V2를 정의하였다. 이때 다음과 같은 SQL문이 실행됐을 떄 발생하는 결과를 올바르게 설명한 것은?
(4)
```
DROP VIEW V1;
```
```
1. V1만 삭제된다.
2. V2만 삭제된다.
3. V1과 V2가 모두 삭제된다.
4. V1과 V2 모두 삭제 되지 않는다.
```

#### 21. 뷰에 대한 설명으로 적합한 것을 모두 고르시오.
```
(A) 뷰는 물리적으로 저장 장치에 저장된다 - (X)
(B) 뷰에 대한 삽입,수정,삭제 연산이 항상 허용되는 것은 아니고 제약이 따른다 - (O)
(C) 뷰는 CREATE 문을 이용해 생성할 수 있다 - (O)
(D) 뷰는 ALTER 문을 이용해 변경할 수 있다 - (X)
(E) 뷰는 DROP 문을 이용해 삭제할 수 있다 - (O)
(F) 기본 테이블이 제거되더라도 뷰는 자동으로 삭제되지 않는다 - (X)
(G) 뷰를 기반으로 새로운 뷰를 만들 수 있다 - (O)
```

#### 23. 뷰를 생성하기 위한 기본 형식 중 WITH CHECK OPTION의 의미를 설명하시오.
뷰가 생성된 이후 뷰에 대한 삽입이나 수정 연산이 실행될 때 뷰 정의 조건을 위반하면 실행을 거부하도록 지시하는 옵션이다.

#### 30. 다음 4개의 테이블 스키마를 보고 각 물음에 답하시오.
```
고객(고객번호, 고객이름, 거주도시, 할인율)
판매자(판매자 번호, 판매자 이름, 수수료, 판매지역)
제품(제품번호, 제품명, 재고량, 가격)
주문(주문번호, 고객번호, 제품번호, 판매자번호, 주문수량)
```

(1) 고객 테이블에 고객번호가 C005, 이름이 채희성, 거주도시가 대구이고, 할인율은 아직 결정되지 않은 고객의 데이터를 삽입하는 SQL문을 작성
```sql
INSERT INTO `고객` (고객번호, 고객이름, 거주도시) VALUES ("C005", "채희성", "대구");
```

(2) 방지호 고객의 주문수량을 20%증가 시키는 SQL 문을 작성하시오.
```sql
UPDATE `주문` SET 주문수량 = 주문수량*1.2
    WHERE 주문.고객번호 IN (SELECT 고객번호 FROM `고객` WHERE 고객.고객이름 = "방지호");
```

(3) 재고량이 50개 미만인 제품을 모두 삭제하는 SQL문을 작성하시오.
```sql
DELETE FROM `제품` WHERE 재고량 < 50;
```

(4) 가격이 가장 최저가인 제품의 제품명을 중복 없이 검색하는 SQL문을 작성하시오.
```sql
SELECT DISTINCT 제품명 FROM `제품`
    WHERE 가격 = (SELECT MIN(가격) FROM `제품`);
```

(5) 제품명에 '부'가 포함된 제품을 주문한 고객의 이름을 검색하는 SQL문을 작성하시오.
```sql
SELECT 고객이름
    FROM `고객`
    WHERE 고객.고객번호 IN (SELECT 주문.고객번호 FROM `주문` INNER JOIN `제품` ON 주문.제품번호 = 제품.제품번호 WHERE 제품.제품명 LIKE "%부%");

SELECT 고객이름
    FROM 고객, 제품, 주문
    WHERE 제품.제품명 LIKE "%부%" AND 고객.고객번호 = 주문.고객번호 AND 제품.제품번호 = 주문.제품번호;
```

(6) 주문수량의 합계가 300이상인 고객에 대해 고객별 주문 횟수와 주문수량의 합계를 검색하는 SQL문을 작성하시오.
```sql

SELECT 고객번호, COUNT(주문번호), SUM(주문수량)
    FROM `주문`
    GROUP BY `고객번호`
    HAVING SUM(주문수량) >= 300;
```

(7) 판매지역이 서울인 모든 판매자의 수수료보다 비싼 수수료를 받는 판매자의 이름과 수수료, 판매지역을 검색하기 위한 SQL문을 작성하시오.

```sql
SELECT 판매자이름, 수수료, 판매지역
    FROM `판매자`
    WHERE 수수료 > ALL (SELECT 수수료 FROM `판매자` WHERE 판매지역="서울");
```